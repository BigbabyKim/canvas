<style>
    .joyStickCanvas:hover{
        cursor: pointer;
    }
</style>

<script >
    var width = 700;
    var x = width / 2;
    var y = width / 2;
    var joyStickCanvas;
    var ctx;

    document.addEventListener('DOMContentLoaded', function () {
        joyStickCanvas = document.querySelector(".joyStickCanvas");
        ctx = joyStickCanvas.getContext('2d');

        fn_joyStick(width); // 길이 설정

        document.addEventListener('mousedown', function (event) {
            drawJoyStirck(event)

            document.addEventListener('mousemove', drawJoyStirck);
        });

        document.addEventListener('mouseup', function (event) {
            document.removeEventListener('mousemove', drawJoyStirck);
            drawReturn(event);
        });
    });

    function fn_joyStick(width) {
        joyStickCanvas.width = width;
        joyStickCanvas.height = width;

        drawBack(width);
        drawStick(width / 2, width / 2);
    };

    function drawBack(width) {
        ctx.clearRect(0, 0, width, width);

        Object.assign(ctx, {
            shadowBlur: 0,
            shadowOffsetX: 0,
            shadowOffsetY: 0,
        });

        ctx.beginPath();
        ctx.arc(width / 2, width / 2, width / 2.4, 0, Math.PI * 2);
        ctx.fillStyle = '#444';
        ctx.fill();
    };

    function drawStick(x, y) {
        Object.assign(ctx, {
            font: `italic bold ${width / 5}px "Georgia", serif`,
            textAlign: "center",
            fillStyle: '#000',
            textBaseline: "middle",
            shadowColor: "rgba(0, 0, 0, 0.6)",
            shadowBlur: 1 / 60 * width,
            shadowOffsetX: 1 / 100 * width,
            shadowOffsetY: 1 / 100 * width,
        });

        var gradient = ctx.createRadialGradient(x / 1.02, y / 1.02, width / 20, x, y, width / 10);
        gradient.addColorStop(0, "#666");
        gradient.addColorStop(1, "#333");

        ctx.beginPath();
        ctx.arc(x, y, width / 10, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();
    };

    function drawJoyStirck(event) {
        var inputX = event.offsetX;
        var inputY = event.offsetY;
        var deg = (Math.atan2(inputY - width / 2, inputX - width / 2) / Math.PI * 180);
        var x = (width / 2.8) * Math.cos(deg * Math.PI / 180);
        var y = (width / 2.8) * Math.sin(deg * Math.PI / 180);

        if (Math.sqrt((inputX - width / 2) ** 2 + (inputY - width / 2) ** 2) > width / 2.8) {
            drawBack(width);
            drawStick(x + width / 2, y + width / 2);
        } else {
            drawBack(width);
            drawStick(event.offsetX, event.offsetY);
        };
    };

    function drawReturn(event) {
        var inputX = event.offsetX;
        var inputY = event.offsetY;
        var deg = (Math.atan2(inputY - width / 2, inputX - width / 2) / Math.PI * 180);
        var resultX = (width / 2.8) * Math.cos(deg * Math.PI / 180) + width / 2;
        var resultY = (width / 2.8) * Math.sin(deg * Math.PI / 180) + width / 2;

        var i = 0;

        function move() {
            var num = i < 8 ? i / 6 : (i === 8 ? 6 / 7 : 1);

            var x = resultX + (width / 2 - resultX) * num;
            var y = resultY + (width / 2 - resultY) * num;

            drawBack(width);
            drawStick(x, y);

            i++ <= 9 && requestAnimationFrame(move);
        };

        move();
    }
</script >

<body >
    <canvas class="joyStickCanvas" > </canvas >
</body >
